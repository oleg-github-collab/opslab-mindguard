# Railway Build Instructions

## Setup

Railway builds from `backend/Dockerfile` with `SQLX_OFFLINE=true`.
That means the repo must contain the `.sqlx/` cache generated by `cargo sqlx prepare`.

### Environment Variables (Set in Railway Dashboard)

**Runtime variables:**
- `DATABASE_URL` - PostgreSQL connection string (Railway provides this)
- `APP_ENC_KEY` - Get from RAILWAY_ENV_VARS_PRIVATE.txt
- `SESSION_KEY` - Get from RAILWAY_ENV_VARS_PRIVATE.txt
- `TELEGRAM_BOT_TOKEN` - Get from RAILWAY_ENV_VARS_PRIVATE.txt
- `OPENAI_API_KEY` - Get from RAILWAY_ENV_VARS_PRIVATE.txt
- `RUST_LOG=info`
- `PORT=3000`

### Build Settings

Railway will automatically:
1. Detect Dockerfile
2. Run `docker build`
3. Use `.sqlx/` for SQLx query verification (offline)
4. Deploy the built image

### Troubleshooting

If build fails with "SQLX_OFFLINE=true but no cached data":
- Run `cargo sqlx prepare` locally with a working `DATABASE_URL`
- Commit `.sqlx/` and push

### Local Development

Generate Cargo.lock and `.sqlx`:

```bash
cargo generate-lockfile
export DATABASE_URL="your-db-url"
cargo sqlx prepare
```

Then you can build offline:

```bash
export SQLX_OFFLINE=true
cargo build --release
```
