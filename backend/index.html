<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpsLab Mindguard ¬∑ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ú–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ó–¥–æ—Ä–æ–≤'—è —Ç–∞ –§—ñ–¥–±–µ–∫—É</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ===== NEOBRUTAL DESIGN SYSTEM ===== */
    :root {
      --primary: #FF6B35;
      --secondary: #FFB347;
      --accent: #00D9FF;
      --success: #00F5A0;
      --warning: #FFB800;
      --danger: #FF4B4B;
      --dark: #1a1a1a;
      --white: #ffffff;
      --gray-light: #f5f5f5;
      --gray: #666666;
      --border: 4px;
      --shadow: 8px 8px 0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background: var(--gray-light);
      color: var(--dark);
      line-height: 1.6;
      overflow-x: hidden;
    }

    .mono { font-family: 'Space Mono', monospace; }

    /* ===== NAVIGATION ===== */
    .nav {
      background: var(--white);
      border-bottom: var(--border) solid var(--dark);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 0 var(--dark);
    }

    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
      flex-wrap: wrap;
    }

    .nav-logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--dark);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-menu {
      display: flex;
      gap: 1rem;
      list-style: none;
      flex: 1;
      justify-content: center;
      flex-wrap: wrap;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .nav-link {
      padding: 0.75rem 1.5rem;
      border: 3px solid var(--dark);
      background: var(--white);
      color: var(--dark);
      text-decoration: none;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 4px 4px 0 var(--dark);
    }

    .nav-link:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--dark);
    }

    .nav-link.active {
      background: var(--primary);
      color: var(--white);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: 3px solid var(--dark);
      font-weight: 700;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--white);
      box-shadow: 4px 4px 0 var(--dark);
    }

    .btn-primary:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--dark);
    }

    .btn-secondary {
      background: var(--white);
      color: var(--dark);
      box-shadow: 4px 4px 0 var(--dark);
    }

    .btn-success {
      background: var(--success);
      color: var(--dark);
      box-shadow: 4px 4px 0 var(--dark);
    }

    /* ===== CONTAINERS ===== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .section { display: none; }
    .section.active { display: block; }
    .hidden { display: none !important; }

    /* ===== CARDS ===== */
    .card {
      background: var(--white);
      border: var(--border) solid var(--dark);
      padding: 2rem;
      box-shadow: var(--shadow) var(--dark);
      margin-bottom: 2rem;
    }

    .card-header {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 3px solid var(--dark);
    }

    /* ===== GRID ===== */
    .grid {
      display: grid;
      gap: 1.5rem;
    }

    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
    .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }

    /* ===== METRIC CARDS ===== */
    .metric-card {
      background: var(--white);
      border: 3px solid var(--dark);
      padding: 1.5rem;
      box-shadow: 6px 6px 0 var(--dark);
      position: relative;
      overflow: hidden;
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
    }

    .metric-card.positive::before { background: var(--success); }
    .metric-card.warning::before { background: var(--warning); }
    .metric-card.danger::before { background: var(--danger); }

    .metric-label {
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--gray);
      margin-bottom: 0.5rem;
    }

    .metric-value {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: 'Space Mono', monospace;
      margin-bottom: 0.5rem;
    }

    .metric-desc {
      font-size: 0.875rem;
      color: var(--gray);
    }

    .metric-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border: 2px solid var(--dark);
      font-size: 0.75rem;
      font-weight: 700;
      margin-top: 0.5rem;
    }

    .badge-success { background: var(--success); }
    .badge-warning { background: var(--warning); }
    .badge-danger { background: var(--danger); }

    /* ===== LOGIN SCREEN ===== */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 2rem;
    }

    .login-container {
      max-width: 450px;
      width: 100%;
      background: var(--white);
      border: var(--border) solid var(--dark);
      padding: 3rem;
      box-shadow: 12px 12px 0 var(--dark);
    }

    .login-container h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .login-container p {
      color: var(--gray);
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .form-group input, .form-group textarea {
      width: 100%;
      padding: 1rem;
      border: 3px solid var(--dark);
      font-family: inherit;
      font-size: 1rem;
    }

    .form-group input:focus, .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .error-message {
      padding: 1rem;
      background: #FFE5E5;
      border: 3px solid var(--danger);
      margin-bottom: 1rem;
      font-weight: 700;
      color: var(--danger);
    }

    /* ===== MONTH SELECTOR ===== */
    .month-selector {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .month-btn {
      padding: 0.75rem 1.5rem;
      border: 3px solid var(--dark);
      background: var(--white);
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      box-shadow: 4px 4px 0 var(--dark);
      transition: all 0.2s;
    }

    .month-btn:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--dark);
    }

    .month-btn.active {
      background: var(--accent);
      color: var(--dark);
    }

    /* ===== WALL POST ===== */
    .wall-post {
      background: var(--white);
      border: 3px solid var(--dark);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 6px 6px 0 var(--dark);
      position: relative;
    }

    .wall-post-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--dark);
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .wall-post-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.875rem;
      flex-wrap: wrap;
    }

    .wall-post-date {
      font-family: 'Space Mono', monospace;
      color: var(--gray);
    }

    .wall-post-sentiment {
      padding: 0.25rem 0.75rem;
      border: 2px solid var(--dark);
      font-weight: 700;
      font-size: 0.75rem;
    }

    .sentiment-positive { background: var(--success); }
    .sentiment-negative { background: var(--danger); }
    .sentiment-mixed { background: var(--warning); }

    .wall-post-content {
      margin-bottom: 1rem;
      line-height: 1.8;
    }

    .wall-post-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .tag {
      padding: 0.25rem 0.75rem;
      background: var(--gray-light);
      border: 2px solid var(--dark);
      font-size: 0.75rem;
      font-weight: 700;
    }

    .wall-category {
      padding: 0.25rem 0.75rem;
      border: 2px solid var(--dark);
      font-weight: 700;
      background: var(--white);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.03em;
    }

    .wall-author {
      font-weight: 700;
    }

    .wall-ai {
      background: var(--accent);
      color: var(--dark);
    }

    .form-hint {
      color: var(--gray);
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }

    .toggle-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }

    .status-chip {
      padding: 0.25rem 0.6rem;
      border: 2px solid var(--dark);
      background: var(--gray-light);
      font-size: 0.75rem;
      font-weight: 700;
    }

    /* ===== ADMIN USERS ===== */
    .admin-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin: 1.5rem 0 1rem;
    }

    .admin-table-wrap {
      overflow-x: auto;
      border: 3px solid var(--dark);
      background: var(--white);
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    .admin-table th,
    .admin-table td {
      border: 2px solid var(--dark);
      padding: 0.75rem 0.9rem;
      text-align: left;
      vertical-align: top;
    }

    .admin-table th {
      background: var(--gray-light);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.04em;
    }

    .admin-row-inactive {
      opacity: 0.6;
      background: #fff7f7;
    }

    .admin-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    /* ===== WELLNESS + INSIGHTS ===== */
    .plan-list,
    .insight-list,
    .kudos-list,
    .pulse-list,
    .moderation-queue {
      display: grid;
      gap: 0.75rem;
    }

    .plan-item,
    .kudos-item,
    .pulse-message,
    .insight-item,
    .moderation-card {
      border: 3px solid var(--dark);
      padding: 1rem;
      background: var(--white);
      box-shadow: 4px 4px 0 var(--dark);
    }

    .plan-title,
    .kudos-message,
    .insight-title {
      font-weight: 700;
    }

    .plan-meta,
    .kudos-meta,
    .insight-meta {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 0.35rem;
    }

    .tag-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .tag-chip {
      padding: 0.25rem 0.6rem;
      border: 2px solid var(--dark);
      background: var(--accent);
      font-size: 0.75rem;
      font-weight: 700;
    }

    .insight-banner {
      margin-top: 1rem;
      border: 3px solid var(--dark);
      padding: 1rem;
      font-weight: 700;
    }

    .insight-banner.level-critical { background: #ffe5e5; }
    .insight-banner.level-alert { background: #fff3e0; }
    .insight-banner.level-watch { background: #f0f6ff; }

    /* ===== PULSE ROOMS ===== */
    .pulse-room-card {
      border: 3px solid var(--dark);
      padding: 1rem;
      background: var(--white);
      box-shadow: 4px 4px 0 var(--dark);
      cursor: pointer;
      transition: all 0.2s;
    }

    .pulse-room-card:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--dark);
    }

    .pulse-room-card.active {
      background: var(--accent);
    }

    .pulse-message.pending {
      background: #fff3e0;
    }

    .moderation-card {
      border-style: dashed;
      background: #fff7f7;
    }

    .action-card {
      border: 2px dashed var(--dark);
      padding: 0.65rem;
      margin-top: 0.5rem;
      background: #fff7f7;
      font-size: 0.85rem;
    }

    /* ===== ANIMATIONS ===== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in { animation: fadeIn 0.5s ease-out; }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .nav-container { flex-direction: column; align-items: flex-start; }
      .nav-menu { width: 100%; justify-content: flex-start; }
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
      .month-selector { justify-content: center; }
      .login-container { padding: 2rem; }
      .card { padding: 1.5rem; }
      .admin-table thead { display: none; }
      .admin-table tr { display: block; margin-bottom: 1rem; }
      .admin-table td { display: flex; justify-content: space-between; gap: 1rem; }
      .admin-table td::before { content: attr(data-label); font-weight: 700; }
    }

    @media (max-width: 560px) {
      .nav-menu { flex-direction: column; }
      .nav-link { width: 100%; text-align: center; }
      .container { padding: 1.25rem; }
    }

    /* ===== LOADING ===== */
    .loading {
      text-align: center;
      padding: 3rem;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--dark);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <!-- ===== LOGIN SCREEN ===== -->
  <div id="login-screen" class="login-screen">
    <div class="login-container fade-in">
      <h1>üß† OpsLab Mindguard</h1>
      <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è —Ç–∞ —Ñ—ñ–¥–±–µ–∫—É –∫–æ–º–∞–Ω–¥–∏</p>

      <div id="error-container"></div>

      <form id="login-form">
        <div class="form-group">
          <label for="email">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–æ—à—Ç–∞</label>
          <input type="email" id="email" name="email" required placeholder="your@opslab.uk" autocomplete="email" />
        </div>

        <div class="form-group">
          <label for="code">–í–∞—à —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π 4-–∑–Ω–∞—á–Ω–∏–π –∫–æ–¥</label>
          <input type="password" id="code" name="code" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" autocomplete="current-password" />
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%;">–£–≤—ñ–π—Ç–∏</button>
      </form>
    </div>
  </div>

  <!-- ===== MAIN APP ===== -->
  <div id="app" class="hidden">

    <!-- Navigation -->
    <nav class="nav">
      <div class="nav-container">
        <a href="#" class="nav-logo">üß† OpsLab Mindguard</a>

        <ul class="nav-menu">
          <li><a href="#" class="nav-link active" data-section="mindguard">üìä Mindguard</a></li>
          <li><a href="#" class="nav-link" data-section="pulse">üó£ Pulse Rooms</a></li>
          <li><a href="#" class="nav-link" data-section="wall">üí¨ –°—Ç—ñ–Ω–∞ –ü–ª–∞—á—É</a></li>
          <li><a href="#" class="nav-link hidden" data-section="admin" id="admin-link">üß© –ö–æ–º–∞–Ω–¥–∞</a></li>
        </ul>

        <div class="nav-actions">
          <span id="user-name" class="mono"></span>
          <span id="user-role" class="status-chip"></span>
          <button id="logout-btn" class="btn btn-secondary">–í–∏–π—Ç–∏</button>
        </div>
      </div>
    </nav>

    <!-- ===== MINDGUARD SECTION ===== -->
    <div id="mindguard-section" class="section active">
      <div class="container">

        <div class="card">
          <div class="card-header">üìä OpsLab Mindguard Analytics</div>
          <p style="color: var(--gray); margin-bottom: 2rem;">
            –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è –∫–æ–º–∞–Ω–¥–∏ —á–µ—Ä–µ–∑ —â–æ–¥–µ–Ω–Ω—ñ —á–µ–∫—ñ–Ω–∏ –≤ Telegram –±–æ—Ç—ñ.
            –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞—É–∫–æ–≤–æ –≤–∞–ª—ñ–¥–æ–≤–∞–Ω—ñ –º–µ—Ç–æ–¥–∏–∫–∏: WHO-5, PHQ-9, GAD-7, MBI.
          </p>

          <!-- Month Selector -->
          <div class="month-selector" id="month-selector"></div>

          <!-- Key Metrics -->
          <div class="grid grid-4">
            <div class="metric-card positive">
              <div class="metric-label">WHO-5 –ë–ª–∞–≥–æ–ø–æ–ª—É—á—á—è</div>
              <div class="metric-value" id="wellbeing-value">65.5</div>
              <div class="metric-desc">–Ü–Ω–¥–µ–∫—Å –±–ª–∞–≥–æ–ø–æ–ª—É—á—á—è –í–û–û–ó</div>
              <span class="metric-badge badge-success" id="wellbeing-badge">–ù–û–†–ú–ê</span>
            </div>

            <div class="metric-card warning">
              <div class="metric-label">PHQ-9 –î–µ–ø—Ä–µ—Å—ñ—è</div>
              <div class="metric-value" id="depression-value">8.25</div>
              <div class="metric-desc">–†—ñ–≤–µ–Ω—å –¥–µ–ø—Ä–µ—Å—ñ—ó</div>
              <span class="metric-badge badge-warning" id="depression-badge">–õ–ï–ì–ö–ê</span>
            </div>

            <div class="metric-card warning">
              <div class="metric-label">GAD-7 –¢—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å</div>
              <div class="metric-value" id="anxiety-value">7.38</div>
              <div class="metric-desc">–†—ñ–≤–µ–Ω—å —Ç—Ä–∏–≤–æ–∂–Ω–æ—Å—Ç—ñ</div>
              <span class="metric-badge badge-warning" id="anxiety-badge">–õ–ï–ì–ö–ê</span>
            </div>

            <div class="metric-card danger">
              <div class="metric-label">MBI –í–∏–≥–æ—Ä–∞–Ω–Ω—è</div>
              <div class="metric-value" id="burnout-value">44.8%</div>
              <div class="metric-desc">–Ü–Ω–¥–µ–∫—Å –≤–∏–≥–æ—Ä–∞–Ω–Ω—è</div>
              <span class="metric-badge badge-warning" id="burnout-badge">–°–ï–†–ï–î–ù–Ü–ô</span>
            </div>
          </div>

          <!-- Additional Metrics -->
          <div class="grid grid-3" style="margin-top: 1.5rem;">
            <div class="metric-card">
              <div class="metric-label">üí§ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Å–Ω—É</div>
              <div class="metric-value" id="sleep-value">6.3</div>
              <div class="metric-desc">–≥–æ–¥–∏–Ω –Ω–∞ –Ω—ñ—á</div>
            </div>

            <div class="metric-card">
              <div class="metric-label">‚öñÔ∏è Work-Life Balance</div>
              <div class="metric-value" id="balance-value">4.9</div>
              <div class="metric-desc">–∑ 10</div>
            </div>

            <div class="metric-card">
              <div class="metric-label">üò∞ –†—ñ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—É</div>
              <div class="metric-value" id="stress-value">23.9</div>
              <div class="metric-desc">–ø–æ–∫–∞–∑–Ω–∏–∫ —Å—Ç—Ä–µ—Å—É</div>
            </div>
          </div>

          <!-- Risk Summary -->
          <div style="margin-top: 2rem; padding: 1.5rem; background: #FFF3E0; border: 3px solid var(--dark);">
            <h3 style="margin-bottom: 1rem;">‚ö†Ô∏è –ó–≤–µ–¥–µ–Ω–Ω—è –ø–æ –†–∏–∑–∏–∫–∞–º</h3>
            <div style="display: flex; gap: 2rem;">
              <div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--warning);" id="risk-count">‚Äî</div>
                <div style="color: var(--gray);" id="risk-primary-label">–†—ñ–≤–µ–Ω—å —Ä–∏–∑–∏–∫—É</div>
              </div>
              <div>
                <div style="font-size: 2rem; font-weight: 700; color: var(--danger);" id="critical-count">‚Äî</div>
                <div style="color: var(--gray);" id="risk-secondary-label">Streak</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">üìà –¢—Ä–µ–Ω–¥–∏ –ø–æ –º—ñ—Å—è—Ü—è—Ö</div>
          <div id="trend-container" class="grid grid-2"></div>
        </div>

        <div class="card" id="wellness-card">
          <div class="card-header">üåø Wellness OS ¬∑ –ü–ª–∞–Ω + –¶—ñ–ª—ñ</div>
          <p style="color: var(--gray); margin-bottom: 1.5rem;">
            –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å, —è–∫–∏–π –∞–¥–∞–ø—Ç—É—î—Ç—å—Å—è –¥–æ –º–µ—Ç—Ä–∏–∫, —Å–Ω—É —Ç–∞ —Å—Ç—Ä–µ—Å—É.
          </p>
          <div class="grid grid-2">
            <div>
              <h4 style="margin-bottom: 0.5rem;">–ü–ª–∞–Ω –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</h4>
              <div id="wellness-plan" class="plan-list">
                <div class="form-hint">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–ª–∞–Ω—É...</div>
              </div>
              <div class="toggle-row">
                <button id="complete-plan-btn" class="btn btn-secondary" type="button">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏–º</button>
                <span id="wellness-plan-status" class="form-hint"></span>
              </div>
            </div>
            <div>
              <h4 style="margin-bottom: 0.5rem;">Wellbeing goals</h4>
              <form id="wellness-goals-form">
                <div class="form-group">
                  <label for="goal-sleep">–°–æ–Ω (–≥–æ–¥/–Ω—ñ—á)</label>
                  <input id="goal-sleep" type="number" min="4" max="10" step="1" />
                </div>
                <div class="form-group">
                  <label for="goal-breaks">–ü–∞—É–∑–∞ / –¥–µ–Ω—å (–∫—ñ–ª—å–∫—ñ—Å—Ç—å)</label>
                  <input id="goal-breaks" type="number" min="1" max="10" step="1" />
                </div>
                <div class="form-group">
                  <label for="goal-move">–†—É—Ö (—Ö–≤ / –¥–µ–Ω—å)</label>
                  <input id="goal-move" type="number" min="5" max="120" step="5" />
                </div>
                <div class="toggle-row">
                  <input type="checkbox" id="goal-notifications" />
                  <label for="goal-notifications">Gentle nudges</label>
                </div>
                <div class="toggle-row">
                  <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏ —Ü—ñ–ª—ñ</button>
                  <span id="wellness-goals-status" class="form-hint"></span>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="card" id="insights-card">
          <div class="card-header">üîç –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —ñ–Ω—Å–∞–π—Ç–∏</div>
          <div class="grid grid-2">
            <div>
              <h4 style="margin-bottom: 0.5rem;">Self-benchmark ¬∑ —Ç–∏ vs —Ç–∏</h4>
              <div id="self-benchmark" class="insight-list">
                <div class="form-hint">–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö</div>
              </div>
            </div>
            <div>
              <h4 style="margin-bottom: 0.5rem;">–ö–æ—Ä–µ–ª—è—Ü—ñ—ó + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h4>
              <div id="correlations-list" class="insight-list">
                <div class="form-hint">–î–∞–Ω—ñ —â–µ –∑–±–∏—Ä–∞—é—Ç—å—Å—è</div>
              </div>
            </div>
          </div>
          <div id="early-signal-banner" class="insight-banner hidden"></div>
        </div>

        <div class="card" id="kudos-card">
          <div class="card-header">üéâ Kudos + Recognition</div>
          <p style="color: var(--gray); margin-bottom: 1rem;">
            –ü—ñ–¥—Ç—Ä–∏–º—É–π—Ç–µ –æ–¥–Ω–µ –æ–¥–Ω–æ–≥–æ. –ü–æ–¥—è–∫–∞ –ø—ñ–¥—Å–∏–ª—é—î –º–æ—Ç–∏–≤–∞—Ü—ñ—é –π –∫—É–ª—å—Ç—É—Ä—É.
          </p>
          <div class="grid grid-2">
            <form id="kudos-form">
              <div class="form-group">
                <label for="kudos-email">Email –∫–æ–ª–µ–≥–∏</label>
                <input id="kudos-email" type="email" placeholder="colleague@opslab.uk" required />
              </div>
              <div class="form-group">
                <label for="kudos-message">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</label>
                <textarea id="kudos-message" rows="3" maxlength="500" placeholder="–î—è–∫—É—é –∑–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É..."></textarea>
              </div>
              <div class="toggle-row">
                <button type="submit" class="btn btn-success">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ kudos</button>
                <span id="kudos-status" class="form-hint"></span>
              </div>
            </form>
            <div>
              <h4 style="margin-bottom: 0.5rem;">–Ü–Ω—Å–∞–π—Ç–∏ –≤–∏–∑–Ω–∞–Ω–Ω—è</h4>
              <div id="kudos-insights" class="tag-row">
                <span class="form-hint">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
              </div>
              <div class="form-hint">–¢–æ–ø —Ç–µ–º–∏ —Ç–∞ –ª—é–¥–∏, —è–∫—ñ –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –¥—è–∫—É—é—Ç—å.</div>
            </div>
          </div>
          <div class="grid grid-2" style="margin-top: 1.5rem;">
            <div>
              <h4 style="margin-bottom: 0.5rem;">–û—Ç—Ä–∏–º–∞–Ω—ñ kudos</h4>
              <div id="kudos-received" class="kudos-list"></div>
            </div>
            <div>
              <h4 style="margin-bottom: 0.5rem;">–ù–∞–¥—ñ—Å–ª–∞–Ω—ñ kudos</h4>
              <div id="kudos-sent" class="kudos-list"></div>
            </div>
          </div>
        </div>

        <!-- Telegram Bot Info -->
        <div class="card">
          <div class="card-header">ü§ñ Telegram Bot Integration</div>
          <p style="margin-bottom: 1rem;">
            –©–æ–¥–µ–Ω–Ω—ñ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é –∞–Ω–∞–ª—ñ—Ç–∏–∫–æ—é —Ç–∞ AI-–ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é.
          </p>
          <div class="grid grid-2">
            <div>
              <h4 style="margin-bottom: 0.5rem;">–î–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:</h4>
              <ul style="list-style: none; padding-left: 0;">
                <li class="mono" style="margin: 0.5rem 0;">üìã /help - –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥</li>
                <li class="mono" style="margin: 0.5rem 0;">‚úÖ /checkin - –©–æ–¥–µ–Ω–Ω–∏–π —á–µ–∫—ñ–Ω</li>
                <li class="mono" style="margin: 0.5rem 0;">üìä /status - –í–∞—à —Å—Ç–∞–Ω</li>
                <li class="mono" style="margin: 0.5rem 0;">üîó /weblogin - –í—Ö—ñ–¥ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</li>
                <li class="mono" style="margin: 0.5rem 0;">üí¨ /wall - –°—Ç—ñ–Ω–∞ –ø–ª–∞—á—É</li>
                <li class="mono" style="margin: 0.5rem 0;">‚è∞ /settime - –ß–∞—Å –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å</li>
                <li class="mono" style="margin: 0.5rem 0;">üåç /timezone - –ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å</li>
                <li class="mono" style="margin: 0.5rem 0;">üîî /notify - –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è on/off</li>
                <li class="mono" style="margin: 0.5rem 0;">‚öôÔ∏è /settings - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</li>
                <li class="mono" style="margin: 0.5rem 0;">üéâ /kudos - –ü–æ–¥—è–∫–∞ –∫–æ–ª–µ–∑—ñ</li>
                <li class="mono" style="margin: 0.5rem 0;">üåø /plan - –ü–ª–∞–Ω Wellness OS</li>
                <li class="mono" style="margin: 0.5rem 0;">üéØ /goals - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ü—ñ–ª—ñ</li>
                <li class="mono" style="margin: 0.5rem 0;">üó£ /pulse - Pulse rooms</li>
                <li class="mono" style="margin: 0.5rem 0;">‚ú® /insight - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —ñ–Ω—Å–∞–π—Ç</li>
              </ul>
            </div>
            <div>
              <h4 style="margin-bottom: 0.5rem;">–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:</h4>
              <ul style="padding-left: 1.5rem;">
                <li>–ì–æ–ª–æ—Å–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—î—é</li>
                <li>AI-–∞–Ω–∞–ª—ñ–∑ –µ–º–æ—Ü—ñ–π–Ω–æ–≥–æ —Å—Ç–∞–Ω—É</li>
                <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è</li>
                <li>–©–æ—Ç–∏–∂–Ω–µ–≤—ñ –∑–≤—ñ—Ç–∏ (–ü'—è—Ç–Ω–∏—Ü—è 17:00)</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="card" id="telegram-settings-card">
          <div class="card-header">üîî –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å</div>
          <div class="grid grid-2">
            <div>
              <h4 style="margin-bottom: 0.5rem;">–°—Ç–∞—Ç—É—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</h4>
              <div id="telegram-connection-status" class="form-hint">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
              <div id="telegram-pin-info" class="form-hint"></div>
              <div class="toggle-row">
                <button id="generate-pin-btn" class="btn btn-secondary" type="button">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ PIN</button>
                <span id="pin-expiry" class="status-chip"></span>
              </div>
              <div class="form-hint">–í—ñ–¥–ø—Ä–∞–≤—Ç–µ PIN —É –±–æ—Ç—ñ –∫–æ–º–∞–Ω–¥–æ—é <span class="mono">/start 1234</span>.</div>
            </div>
            <div>
              <h4 style="margin-bottom: 0.5rem;">–û—Å–æ–±–∏—Å—Ç—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h4>
              <form id="telegram-settings-form">
                <div class="form-group">
                  <label for="reminder-time">–ß–∞—Å –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å</label>
                  <input type="time" id="reminder-time" />
                </div>
                <div class="form-group">
                  <label for="timezone-input">–ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å</label>
                  <input type="text" id="timezone-input" placeholder="Europe/Kyiv –∞–±–æ UTC+2" />
                </div>
                <div class="toggle-row">
                  <input type="checkbox" id="notifications-enabled" />
                  <label for="notifications-enabled">–£–≤—ñ–º–∫–Ω—É—Ç–∏ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è</label>
                </div>
                <div class="toggle-row">
                  <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                  <span id="telegram-settings-status" class="form-hint"></span>
                </div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ===== WALL OF TEARS SECTION ===== -->
    <div id="wall-section" class="section">
      <div class="container">

        <div class="card">
          <div class="card-header">üí¨ –°—Ç—ñ–Ω–∞ –ü–ª–∞—á—É (Wall of Tears)</div>
          <p style="color: var(--gray); margin-bottom: 2rem;">
            –ü—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è —á–µ—Å–Ω–æ–≥–æ —Ñ—ñ–¥–±–µ–∫—É –ø—Ä–æ —Ä–æ–±–æ—Ç—É, –∫–æ–º–∞–Ω–¥—É —Ç–∞ –ø—Ä–æ—Ü–µ—Å–∏.
            –ú–æ–∂–Ω–∞ –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –∞–Ω–æ–Ω—ñ–º–Ω–æ –∞–±–æ –∑ —ñ–º º—è–º.
            –í—Å—ñ –¥–∞–Ω—ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ —Ç–∞ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ AI –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç—Ä–µ–Ω–¥—ñ–≤.
          </p>

          <!-- Post Form -->
          <div style="background: var(--gray-light); padding: 1.5rem; border: 3px solid var(--dark); margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1rem;">‚úçÔ∏è –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –ø–æ—Å—Ç</h3>
            <form id="wall-post-form">
              <div class="form-group">
                <label for="post-content">–í–∞—à —Ñ—ñ–¥–±–µ–∫</label>
                <textarea
                  id="post-content"
                  style="width: 100%; padding: 1rem; border: 3px solid var(--dark); font-family: inherit; min-height: 120px; resize: vertical;"
                  placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —â–æ –≤–∞—Å —Ç—É—Ä–±—É—î –∞–±–æ —Ä–∞–¥—É—î..."
                  maxlength="5000"
                ></textarea>
                <div class="toggle-row">
                  <input type="checkbox" id="post-anonymous" checked />
                  <label for="post-anonymous">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –∞–Ω–æ–Ω—ñ–º–Ω–æ</label>
                  <span id="post-visibility-preview" class="status-chip">–ê–Ω–æ–Ω—ñ–º–Ω–æ</span>
                </div>
                <div class="form-hint">–î–ª—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤–∞—à–µ —ñ–º º—è.</div>
              </div>
              <div class="toggle-row">
                <button type="submit" class="btn btn-success">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
                <span id="wall-post-status" class="form-hint"></span>
              </div>
            </form>
          </div>

          <!-- Posts List -->
          <div id="wall-posts-container">
            <div class="loading">
              <div class="spinner"></div>
              <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–≤...</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ===== PULSE ROOMS SECTION ===== -->
    <div id="pulse-section" class="section">
      <div class="container">
        <div class="card">
          <div class="card-header">üó£ Pulse Rooms</div>
          <p style="color: var(--gray); margin-bottom: 1.5rem;">
            –ê–Ω–æ–Ω—ñ–º–Ω—ñ –∫–æ–º–∞–Ω–¥–Ω—ñ pulse-–∫—ñ–º–Ω–∞—Ç–∏ –∑ –º–æ–¥–µ—Ä–∞—Ü—ñ—î—é –¥–ª—è —á–µ—Å–Ω–∏—Ö –æ–±–≥–æ–≤–æ—Ä–µ–Ω—å.
          </p>
          <div id="pulse-rooms" class="grid grid-3"></div>
        </div>

        <div class="card">
          <div class="card-header">üí¨ –û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏</div>
          <div id="pulse-room-meta" class="form-hint">–û–±–µ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É</div>
          <div id="pulse-messages" class="pulse-list"></div>
          <form id="pulse-message-form" style="margin-top: 1rem;">
            <div class="form-group">
              <label for="pulse-message-content">–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</label>
              <textarea id="pulse-message-content" rows="3" maxlength="3000" placeholder="–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –¥—É–º–∫–∞–º–∏..."></textarea>
              <div class="toggle-row">
                <input type="checkbox" id="pulse-anonymous" checked />
                <label for="pulse-anonymous">–ù–∞–¥—Å–∏–ª–∞—Ç–∏ –∞–Ω–æ–Ω—ñ–º–Ω–æ</label>
              </div>
            </div>
            <div class="toggle-row">
              <button type="submit" class="btn btn-success">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
              <span id="pulse-message-status" class="form-hint"></span>
            </div>
          </form>
        </div>

        <div class="card hidden" id="pulse-moderation-card">
          <div class="card-header">üõ°Ô∏è –ß–µ—Ä–≥–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—ó</div>
          <div id="pulse-moderation-queue" class="moderation-queue"></div>
        </div>
      </div>
    </div>

    <!-- ===== ADMIN SECTION ===== -->
    <div id="admin-section" class="section">
      <div class="container">
        <div class="card">
          <div class="card-header">üë• –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏</div>
          <p style="color: var(--gray); margin-bottom: 1.5rem;">
            –°—Ç–≤–æ—Ä—é–π—Ç–µ –Ω–æ–≤—ñ –∞–∫–∞—É–Ω—Ç–∏, –¥–µ–∞–∫—Ç–∏–≤—É–π—Ç–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏—Ö —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª—é–π—Ç–µ –¥–æ—Å—Ç—É–ø –∑–∞ –ø–æ—Ç—Ä–µ–±–∏.
            –î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏.
          </p>

          <div class="grid grid-2">
            <form id="admin-user-form">
              <div class="form-group">
                <label for="admin-user-name">–Ü–º º—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ</label>
                <input id="admin-user-name" type="text" placeholder="–Ü–º º—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" required />
              </div>
              <div class="form-group">
                <label for="admin-user-email">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–æ—à—Ç–∞</label>
                <input id="admin-user-email" type="email" placeholder="user@opslab.uk" required />
              </div>
              <div class="form-group">
                <label for="admin-user-role">–†–æ–ª—å</label>
                <select id="admin-user-role">
                  <option value="EMPLOYEE">EMPLOYEE</option>
                  <option value="FOUNDER">FOUNDER</option>
                  <option value="ADMIN">ADMIN</option>
                </select>
              </div>
              <div class="form-group">
                <label for="admin-user-code">4-–∑–Ω–∞—á–Ω–∏–π –∫–æ–¥</label>
                <div class="toggle-row">
                  <input id="admin-user-code" type="text" maxlength="4" placeholder="1234" />
                  <button id="generate-user-code" class="btn btn-secondary" type="button">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
                </div>
              </div>
              <div class="form-group">
                <label for="admin-user-note">–ù–æ—Ç–∞—Ç–∫–∞ (–æ–ø—Ü—ñ–π–Ω–æ)</label>
                <input id="admin-user-note" type="text" placeholder="–ö–æ–º–∞–Ω–¥–∞, –≤—ñ–¥–¥—ñ–ª –∞–±–æ —Ä–æ–ª—å" />
              </div>
              <div class="toggle-row">
                <button type="submit" class="btn btn-primary">–î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</button>
                <span id="admin-user-status" class="form-hint"></span>
              </div>
            </form>
            <div>
              <h4 style="margin-bottom: 0.75rem;">–ü—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h4>
              <ul style="padding-left: 1.2rem;">
                <li>–ö–æ–¥ –¥–æ—Å—Ç—É–ø—É –ø–æ–≤—ñ–¥–æ–º–ª—è—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –æ–∫—Ä–µ–º–∏–º –∫–∞–Ω–∞–ª–æ–º.</li>
                <li>–ü—ñ—Å–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó Telegram ID –æ—á–∏—â—É—î—Ç—å—Å—è –¥–ª—è –±–µ–∑–ø–µ–∫–∏.</li>
                <li>–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –Ω–µ –≤–∏–¥–∞–ª—è—î —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ.</li>
              </ul>
            </div>
          </div>

          <div class="admin-toolbar">
            <input id="admin-user-search" type="text" placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º º—è–º –∞–±–æ email" />
            <label class="toggle-row" style="margin: 0;">
              <input type="checkbox" id="admin-show-inactive" checked />
              <span>–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö</span>
            </label>
          </div>

          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
                  <th>–†–æ–ª—å</th>
                  <th>–°—Ç–∞—Ç—É—Å</th>
                  <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
                  <th>–í—ñ–¥–∫–ª—é—á–µ–Ω–æ</th>
                  <th>–î—ñ—ó</th>
                </tr>
              </thead>
              <tbody id="admin-users-table"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-header">üß© –ö–æ–º–∞–Ω–¥–Ω–∏–π Heatmap</div>
          <p style="color: var(--gray); margin-bottom: 1.5rem;">
            –°—Ç–∞–Ω –∫–æ–º–∞–Ω–¥–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —â–æ–¥–µ–Ω–Ω–∏—Ö —á–µ–∫—ñ–Ω—ñ–≤ (–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è Admin/Founder).
          </p>
          <div id="team-heatmap" class="grid grid-3"></div>
        </div>

        <div class="card" id="wall-toxicity-card">
          <div class="card-header">üõ°Ô∏è Toxicity Summary (HR)</div>
          <p style="color: var(--gray); margin-bottom: 1rem;">
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–æ–∫—Å–∏—á–Ω–∏—Ö —Ç–µ–º —É —Å—Ç—ñ–Ω—ñ –ø–ª–∞—á—É. –ê–Ω–æ–Ω—ñ–º–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—è.
          </p>
          <div id="wall-toxicity-summary" class="insight-list"></div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ===== GLOBAL STATE =====
    let currentUser = null;
    let currentSection = 'mindguard';
    let historyMonths = [];
    let selectedMonthKey = null;
    let userMetrics = null;
    let userStats = { checkins_last_week: 0, streak: 0 };
    let teamHeatmap = null;
    let adminUsers = [];
    let adminSearch = '';
    let showInactiveUsers = true;
    let wellnessPlan = null;
    let wellnessGoals = null;
    let insights = { selfBenchmark: null, correlations: [], earlySignal: null };
    let kudosData = null;
    let pulseRooms = [];
    let activePulseRoom = null;
    let pulseMessages = [];
    let pulseModerationQueue = [];

    const categoryMap = {
      Complaint: { label: '–°–∫–∞—Ä–≥–∞', emoji: 'üò§' },
      Suggestion: { label: '–ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è', emoji: 'üí°' },
      Celebration: { label: '–£—Å–ø—ñ—Ö', emoji: 'üéâ' },
      Question: { label: '–ü–∏—Ç–∞–Ω–Ω—è', emoji: '‚ùì' },
      SupportNeeded: { label: '–ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞', emoji: 'üíô' }
    };

    // ===== API HELPERS =====
    async function apiCall(endpoint, options = {}) {
      const response = await fetch(endpoint, {
        ...options,
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
          ...options.headers,
        },
      });

      if (response.status === 401) {
        showLogin();
        throw new Error('Unauthorized');
      }

      if (response.status === 204) {
        return null;
      }

      if (!response.ok) {
        const text = await response.text().catch(() => '');
        throw new Error(text || `HTTP ${response.status}`);
      }

      const contentType = response.headers.get('content-type') || '';
      if (contentType.includes('application/json')) {
        return response.json();
      }
      return null;
    }

    // ===== LOGIN =====
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const code = document.getElementById('code').value;
      const errorContainer = document.getElementById('error-container');
      errorContainer.innerHTML = '';

      try {
        const response = await fetch('/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, code }),
          credentials: 'include',
        });

        if (!response.ok) {
          throw new Error('–ù–µ–≤—ñ—Ä–Ω–∏–π email –∞–±–æ –∫–æ–¥');
        }

        currentUser = await response.json();
        await loadApp();

      } catch (error) {
        errorContainer.innerHTML = `
          <div class="error-message">
            ‚ùå ${error.message}
          </div>
        `;
      }
    });

    // ===== LOGOUT =====
    document.getElementById('logout-btn').addEventListener('click', async () => {
      try {
        await fetch('/auth/logout', { method: 'POST', credentials: 'include' });
      } finally {
        showLogin();
      }
    });

    // ===== NAVIGATION =====
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const section = link.dataset.section;
        switchSection(section);
      });
    });

    function switchSection(section) {
      if (section === 'admin' && !isAdmin()) {
        return;
      }
      currentSection = section;

      // Update nav
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.querySelector(`[data-section="${section}"]`).classList.add('active');

      // Update sections
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(`${section}-section`).classList.add('active');

      // Load data
      if (section === 'mindguard') {
        loadMindguardData();
      } else if (section === 'pulse') {
        loadPulseRooms();
        if (isAdmin()) {
          loadPulseModeration();
        }
      } else if (section === 'wall') {
        loadWallPosts();
      } else if (section === 'admin') {
        loadTeamHeatmap();
        loadAdminUsers();
        loadWallToxicitySummary();
      }
    }

    // ===== LOAD APP =====
    async function loadApp() {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');

      // Set user name
      document.getElementById('user-name').textContent = currentUser?.name || 'User';
      document.getElementById('user-role').textContent = currentUser?.role || '';

      const adminLink = document.getElementById('admin-link');
      if (isAdmin()) {
        adminLink.classList.remove('hidden');
      } else {
        adminLink.classList.add('hidden');
      }

      const anonToggle = document.getElementById('post-anonymous');
      const anonPreview = document.getElementById('post-visibility-preview');
      if (anonToggle && anonPreview) {
        anonToggle.checked = true;
        anonPreview.textContent = '–ê–Ω–æ–Ω—ñ–º–Ω–æ';
      }

      // Load initial data
      await loadMindguardData();
    }

    function showLogin() {
      document.getElementById('app').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      currentUser = null;
    }

    function isAdmin() {
      return currentUser?.role === 'ADMIN' || currentUser?.role === 'FOUNDER';
    }

    // ===== MINDGUARD DATA =====
    async function loadMindguardData() {
      const [metricsResponse, historyResponse] = await Promise.all([
        apiCall('/dashboard/metrics'),
        apiCall(`/dashboard/user/${currentUser.user_id}/history`)
      ]);

      userMetrics = metricsResponse?.metrics || null;
      userStats = {
        checkins_last_week: metricsResponse?.checkins_last_week || 0,
        streak: metricsResponse?.streak || 0
      };
      historyMonths = historyResponse?.months || [];

      renderMonthSelector();
      renderMetrics();
      renderTrends();
      renderRiskSummary();
      await loadTelegramStatus();
      await Promise.all([
        loadWellnessData(),
        loadInsights(),
        loadKudos(),
      ]);

      if (isAdmin()) {
        await loadTeamHeatmap();
      }
    }

    function renderMonthSelector() {
      const container = document.getElementById('month-selector');
      container.innerHTML = '';

      if (!historyMonths.length) {
        container.innerHTML = '<span class="form-hint">–ù–µ–º–∞—î —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö</span>';
        return;
      }

      const monthKey = (m) => `${m.year}-${m.month}`;
      if (!selectedMonthKey || !historyMonths.find(m => monthKey(m) === selectedMonthKey)) {
        selectedMonthKey = monthKey(historyMonths[0]);
      }

      historyMonths.slice(0, 6).forEach((month) => {
        const key = monthKey(month);
        const button = document.createElement('button');
        button.className = `month-btn${key === selectedMonthKey ? ' active' : ''}`;
        button.textContent = `${month.month_name} ${month.year}`;
        button.addEventListener('click', () => {
          selectedMonthKey = key;
          renderMonthSelector();
          renderMetrics();
        });
        container.appendChild(button);
      });
    }

    function getSelectedMonth() {
      if (!selectedMonthKey) return null;
      return historyMonths.find(m => `${m.year}-${m.month}` === selectedMonthKey) || null;
    }

    function renderMetrics() {
      const selectedMonth = getSelectedMonth();
      const fallback = userMetrics;

      const who5 = selectedMonth?.who5_score ?? fallback?.who5_score ?? null;
      const phq9 = selectedMonth?.phq9_score ?? fallback?.phq9_score ?? null;
      const gad7 = selectedMonth?.gad7_score ?? fallback?.gad7_score ?? null;
      const burnout = selectedMonth?.burnout_percentage ?? fallback?.mbi_score ?? null;

      document.getElementById('wellbeing-value').textContent = who5 !== null ? who5.toFixed(1) : '‚Äî';
      document.getElementById('depression-value').textContent = phq9 !== null ? phq9.toFixed(1) : '‚Äî';
      document.getElementById('anxiety-value').textContent = gad7 !== null ? gad7.toFixed(1) : '‚Äî';
      document.getElementById('burnout-value').textContent = burnout !== null ? `${burnout.toFixed(1)}%` : '‚Äî';

      document.getElementById('sleep-value').textContent = fallback?.sleep_duration !== undefined
        ? fallback.sleep_duration.toFixed(1)
        : '‚Äî';
      document.getElementById('balance-value').textContent = fallback?.work_life_balance !== undefined
        ? fallback.work_life_balance.toFixed(1)
        : '‚Äî';
      document.getElementById('stress-value').textContent = fallback?.stress_level !== undefined
        ? fallback.stress_level.toFixed(1)
        : '‚Äî';

      updateBadges({ who5, phq9, gad7, burnout });
    }

    function renderTrends() {
      const container = document.getElementById('trend-container');
      container.innerHTML = '';

      if (!historyMonths.length) {
        container.innerHTML = '<div class="form-hint">–ù–µ–º–∞—î —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è —Ç—Ä–µ–Ω–¥—ñ–≤</div>';
        return;
      }

      const latest = historyMonths[0];
      const previous = historyMonths[1];
      const metrics = [
        { key: 'who5_score', label: 'WHO-5', max: 100, higherIsBetter: true },
        { key: 'phq9_score', label: 'PHQ-9', max: 27, higherIsBetter: false },
        { key: 'gad7_score', label: 'GAD-7', max: 21, higherIsBetter: false },
        { key: 'burnout_percentage', label: 'Burnout', max: 100, higherIsBetter: false },
        { key: 'stress_level', label: '–°—Ç—Ä–µ—Å', max: 40, higherIsBetter: false },
      ];

      metrics.slice(0, 4).forEach(metric => {
        const value = latest?.[metric.key];
        const prev = previous?.[metric.key];
        const delta = value !== undefined && prev !== undefined ? value - prev : null;
        const improving = delta !== null
          ? (metric.higherIsBetter ? delta > 0 : delta < 0)
          : null;
        const deltaSymbol = delta === null
          ? '‚Äî'
          : (Math.abs(delta) < 0.5 ? '‚Üí' : (delta > 0 ? '‚Üë' : '‚Üì'));
        const deltaColor = improving === null ? 'var(--gray)' : (improving ? 'var(--success)' : 'var(--danger)');

        const card = document.createElement('div');
        card.className = 'metric-card';

        const displayValue = value !== undefined && value !== null ? value.toFixed(1) : '‚Äî';
        const percent = value !== undefined && value !== null
          ? Math.min(100, Math.max(0, (value / metric.max) * 100))
          : 0;

        card.innerHTML = `
          <div class="metric-label">${metric.label}</div>
          <div class="metric-value">${displayValue}</div>
          <div class="form-hint" style="color: ${deltaColor}; font-weight: 700;">
            ${deltaSymbol} ${delta !== null ? delta.toFixed(1) : ''}
          </div>
          <div style="margin-top: 0.75rem;">
            <div style="height: 10px; border: 2px solid var(--dark); background: var(--gray-light);">
              <div style="height: 100%; width: ${percent}%; background: var(--primary);"></div>
            </div>
          </div>
        `;

        container.appendChild(card);
      });
    }

    function updateBadges({ who5, phq9, gad7, burnout }) {
      setBadge('wellbeing-badge', who5, [
        { max: 35, label: '–ö–†–ò–¢–ò–ß–ù–û', cls: 'badge-danger' },
        { max: 50, label: '–ù–ò–ó–¨–ö–ò–ô', cls: 'badge-warning' },
        { max: 75, label: '–ù–û–†–ú–ê', cls: 'badge-success' },
        { max: 100, label: '–í–Ü–î–ú–Ü–ù–ù–û', cls: 'badge-success' },
      ], true);

      setBadge('depression-badge', phq9, [
        { max: 5, label: '–ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê', cls: 'badge-success' },
        { max: 10, label: '–õ–ï–ì–ö–ê', cls: 'badge-warning' },
        { max: 15, label: '–ü–û–ú–Ü–†–ù–ê', cls: 'badge-warning' },
        { max: 100, label: '–í–ò–°–û–ö–ê', cls: 'badge-danger' },
      ], false);

      setBadge('anxiety-badge', gad7, [
        { max: 5, label: '–ú–Ü–ù–Ü–ú–ê–õ–¨–ù–ê', cls: 'badge-success' },
        { max: 10, label: '–õ–ï–ì–ö–ê', cls: 'badge-warning' },
        { max: 15, label: '–ü–û–ú–Ü–†–ù–ê', cls: 'badge-warning' },
        { max: 100, label: '–í–ò–°–û–ö–ê', cls: 'badge-danger' },
      ], false);

      setBadge('burnout-badge', burnout, [
        { max: 35, label: '–ù–ò–ó–¨–ö–ò–ô', cls: 'badge-success' },
        { max: 50, label: '–°–ï–†–ï–î–ù–Ü–ô', cls: 'badge-warning' },
        { max: 70, label: '–í–ò–°–û–ö–ò–ô', cls: 'badge-warning' },
        { max: 100, label: '–ö–†–ò–¢–ò–ß–ù–ò–ô', cls: 'badge-danger' },
      ], false);
    }

    function setBadge(id, value, levels) {
      const badge = document.getElementById(id);
      if (!badge) return;
      badge.classList.remove('badge-success', 'badge-warning', 'badge-danger');

      if (value === null || value === undefined) {
        badge.textContent = '–ù/–î';
        badge.classList.add('badge-warning');
        return;
      }

      const level = levels.find(l => value <= l.max) || levels[levels.length - 1];
      badge.textContent = level.label;
      badge.classList.add(level.cls);
    }

    function computeRisk(metrics) {
      if (!metrics) {
        return { label: '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö', color: 'var(--gray)', emoji: '‚ö™' };
      }
      if (metrics.who5_score < 50 || metrics.phq9_score >= 15 || metrics.gad7_score >= 15 || metrics.mbi_score >= 70) {
        return { label: '–ö—Ä–∏—Ç–∏—á–Ω–∏–π', color: 'var(--danger)', emoji: 'üî¥' };
      }
      if (metrics.who5_score < 60 || metrics.phq9_score >= 10 || metrics.gad7_score >= 10 || metrics.mbi_score >= 50) {
        return { label: '–í–∏—Å–æ–∫–∏–π', color: 'var(--warning)', emoji: 'üü†' };
      }
      if (metrics.who5_score < 70 || metrics.phq9_score >= 5 || metrics.gad7_score >= 5 || metrics.mbi_score >= 35) {
        return { label: '–°–µ—Ä–µ–¥–Ω—ñ–π', color: '#ffb800', emoji: 'üü°' };
      }
      return { label: '–ù–∏–∑—å–∫–∏–π', color: 'var(--success)', emoji: 'üü¢' };
    }

    function renderRiskSummary() {
      const riskCountEl = document.getElementById('risk-count');
      const criticalCountEl = document.getElementById('critical-count');
      const riskLabelEl = document.getElementById('risk-primary-label');
      const secondaryLabelEl = document.getElementById('risk-secondary-label');

      if (isAdmin() && teamHeatmap?.users?.length) {
        const critical = teamHeatmap.users.filter(u => u.status === 'CRITICAL').length;
        const concerning = teamHeatmap.users.filter(u => u.status === 'CONCERNING').length;
        const atRisk = critical + concerning;

        riskCountEl.textContent = atRisk;
        riskCountEl.style.color = 'var(--warning)';
        criticalCountEl.textContent = critical;
        criticalCountEl.style.color = 'var(--danger)';
        riskLabelEl.textContent = '–£ –∑–æ–Ω—ñ —Ä–∏–∑–∏–∫—É';
        secondaryLabelEl.textContent = '–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å—Ç–∞–Ω';
        return;
      }

      const risk = computeRisk(userMetrics);
      riskCountEl.textContent = `${risk.emoji} ${risk.label}`;
      riskCountEl.style.color = risk.color;
      criticalCountEl.textContent = `${userStats.streak} –¥–Ω—ñ–≤`;
      criticalCountEl.style.color = 'var(--dark)';
      riskLabelEl.textContent = '–†—ñ–≤–µ–Ω—å —Ä–∏–∑–∏–∫—É';
      secondaryLabelEl.textContent = 'Streak';
    }

    // ===== WELLNESS =====
    async function loadWellnessData() {
      try {
        const [goals, plan] = await Promise.all([
          apiCall('/wellness/goals'),
          apiCall('/wellness/plan'),
        ]);
        wellnessGoals = goals;
        wellnessPlan = plan;
        renderWellness();
      } catch (error) {
        const container = document.getElementById('wellness-plan');
        if (container) {
          container.innerHTML = '<div class="form-hint">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–ª–∞–Ω</div>';
        }
      }
    }

    function renderWellness() {
      const planContainer = document.getElementById('wellness-plan');
      const planStatus = document.getElementById('wellness-plan-status');
      const completeBtn = document.getElementById('complete-plan-btn');

      if (planContainer) {
        planContainer.innerHTML = '';
        const items = wellnessPlan?.items || [];
        if (!items.length) {
          planContainer.innerHTML = '<div class="form-hint">–ü–ª–∞–Ω –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—ñ—Å–ª—è —á–µ–∫—ñ–Ω—É</div>';
        } else {
          items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'plan-item';
            const duration = item.duration_minutes ? ` ¬∑ ${item.duration_minutes} —Ö–≤` : '';
            card.innerHTML = `
              <div class="plan-title">${item.title}${duration}</div>
              <div class="plan-meta">${item.description}</div>
            `;
            planContainer.appendChild(card);
          });
        }
      }

      if (planStatus && completeBtn) {
        if (wellnessPlan?.completed_at) {
          planStatus.textContent = '‚úÖ –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–æ';
          completeBtn.disabled = true;
        } else {
          planStatus.textContent = '';
          completeBtn.disabled = false;
        }
      }

      if (wellnessGoals) {
        const sleepInput = document.getElementById('goal-sleep');
        const breakInput = document.getElementById('goal-breaks');
        const moveInput = document.getElementById('goal-move');
        const notifyInput = document.getElementById('goal-notifications');
        if (sleepInput) sleepInput.value = wellnessGoals.sleep_target ?? 7;
        if (breakInput) breakInput.value = wellnessGoals.break_target ?? 3;
        if (moveInput) moveInput.value = wellnessGoals.move_target ?? 20;
        if (notifyInput) notifyInput.checked = !!wellnessGoals.notifications_enabled;
      }
    }

    // ===== INSIGHTS =====
    async function loadInsights() {
      try {
        const [benchmark, correlations, earlySignal] = await Promise.all([
          apiCall('/insights/self-benchmark'),
          apiCall('/insights/correlations'),
          apiCall('/insights/early-signal'),
        ]);
        insights.selfBenchmark = benchmark;
        insights.correlations = correlations || [];
        insights.earlySignal = earlySignal;
        renderInsights();
      } catch (error) {
        renderInsights();
      }
    }

    function renderInsights() {
      renderSelfBenchmark(insights.selfBenchmark);
      renderCorrelations(insights.correlations || []);
      renderEarlySignal(insights.earlySignal);
    }

    function renderSelfBenchmark(benchmark) {
      const container = document.getElementById('self-benchmark');
      if (!container) return;

      container.innerHTML = '';
      if (!benchmark) {
        container.innerHTML = '<div class="form-hint">–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è</div>';
        return;
      }

      const current = benchmark.current;
      const summary = document.createElement('div');
      summary.className = 'insight-item';
      summary.innerHTML = `
        <div class="insight-title">–û—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤</div>
        <div class="insight-meta">WHO-5: ${current.who5.toFixed(1)} ¬∑ Burnout: ${current.burnout.toFixed(1)}%</div>
      `;
      container.appendChild(summary);

      if (!benchmark.deltas || !benchmark.previous) {
        const note = document.createElement('div');
        note.className = 'form-hint';
        note.textContent = '–ó–±–∏—Ä–∞—î–º–æ —â–µ 7 –¥–Ω—ñ–≤ –¥–∞–Ω–∏—Ö –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è.';
        container.appendChild(note);
        return;
      }

      const metrics = [
        { key: 'who5', label: 'WHO-5', higherBetter: true, suffix: '' },
        { key: 'phq9', label: 'PHQ-9', higherBetter: false, suffix: '' },
        { key: 'gad7', label: 'GAD-7', higherBetter: false, suffix: '' },
        { key: 'burnout', label: 'Burnout', higherBetter: false, suffix: '%' },
        { key: 'stress', label: '–°—Ç—Ä–µ—Å', higherBetter: false, suffix: '' },
        { key: 'sleep', label: '–°–æ–Ω', higherBetter: true, suffix: 'h' },
        { key: 'balance', label: '–ë–∞–ª–∞–Ω—Å', higherBetter: true, suffix: '' },
      ];

      metrics.forEach(metric => {
        const delta = benchmark.deltas[metric.key];
        if (delta === null || delta === undefined || Math.abs(delta) < 0.4) return;
        const arrow = delta > 0 ? '‚Üë' : '‚Üì';
        const improving = metric.higherBetter ? delta > 0 : delta < 0;
        const color = improving ? 'var(--success)' : 'var(--warning)';
        const item = document.createElement('div');
        item.className = 'insight-item';
        item.innerHTML = `
          <div class="insight-title" style="color:${color};">${metric.label} ${arrow} ${delta.toFixed(1)}${metric.suffix}</div>
          <div class="insight-meta">–¢–µ–ø–µ—Ä: ${benchmark.current[metric.key].toFixed(1)}${metric.suffix} ¬∑ –ë—É–ª–æ: ${benchmark.previous[metric.key].toFixed(1)}${metric.suffix}</div>
        `;
        container.appendChild(item);
      });
    }

    function renderCorrelations(list) {
      const container = document.getElementById('correlations-list');
      if (!container) return;
      container.innerHTML = '';

      if (!list || list.length === 0) {
        container.innerHTML = '<div class="form-hint">–ö–æ—Ä–µ–ª—è—Ü—ñ—ó –∑ º—è–≤–ª—è—Ç—å—Å—è –ø—ñ—Å–ª—è 2-3 —Ç–∏–∂–Ω—ñ–≤ –¥–∞–Ω–∏—Ö</div>';
        return;
      }

      list.slice(0, 4).forEach(item => {
        const card = document.createElement('div');
        card.className = 'insight-item';
        card.innerHTML = `
          <div class="insight-title">${item.description}</div>
          <div class="insight-meta">${item.recommendation}</div>
        `;
        container.appendChild(card);
      });
    }

    function renderEarlySignal(signal) {
      const banner = document.getElementById('early-signal-banner');
      if (!banner) return;

      if (!signal) {
        banner.classList.add('hidden');
        return;
      }

      const labels = {
        critical: '–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å–∏–≥–Ω–∞–ª',
        alert: '–£–≤–∞–≥–∞: —Ä–∞–Ω–Ω—ñ–π —Å–∏–≥–Ω–∞–ª',
        watch: '–°–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î–º–æ —Ç—Ä–µ–Ω–¥',
      };
      banner.classList.remove('hidden', 'level-critical', 'level-alert', 'level-watch');
      banner.classList.add(`level-${signal.level}`);
      banner.innerHTML = `
        ‚ö° ${labels[signal.level] || '–†–∞–Ω–Ω—ñ–π —Å–∏–≥–Ω–∞–ª'} ¬∑ confidence ${(signal.confidence * 100).toFixed(0)}%
        <div class="form-hint">–Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏: ${(signal.indicators || []).join(', ')}</div>
      `;
    }

    // ===== KUDOS =====
    async function loadKudos() {
      try {
        kudosData = await apiCall('/kudos');
        renderKudos();
      } catch (error) {
        const container = document.getElementById('kudos-received');
        if (container) {
          container.innerHTML = '<div class="form-hint">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ kudos</div>';
        }
      }
    }

    function renderKudos() {
      const receivedContainer = document.getElementById('kudos-received');
      const sentContainer = document.getElementById('kudos-sent');
      const insightsContainer = document.getElementById('kudos-insights');

      if (receivedContainer) receivedContainer.innerHTML = '';
      if (sentContainer) sentContainer.innerHTML = '';
      if (insightsContainer) insightsContainer.innerHTML = '';

      if (!kudosData) return;

      const topSenders = kudosData.insights?.top_senders || [];
      const topKeywords = kudosData.insights?.top_keywords || [];

      if (insightsContainer) {
        if (topSenders.length === 0 && topKeywords.length === 0) {
          insightsContainer.innerHTML = '<span class="form-hint">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è —ñ–Ω—Å–∞–π—Ç—ñ–≤</span>';
        } else {
          topSenders.forEach(name => {
            const chip = document.createElement('span');
            chip.className = 'tag-chip';
            chip.textContent = `‚≠ê ${name}`;
            insightsContainer.appendChild(chip);
          });
          topKeywords.forEach(word => {
            const chip = document.createElement('span');
            chip.className = 'tag-chip';
            chip.textContent = `#${word}`;
            insightsContainer.appendChild(chip);
          });
        }
      }

      if (receivedContainer) {
        if (!kudosData.received || kudosData.received.length === 0) {
          receivedContainer.innerHTML = '<div class="form-hint">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö kudos</div>';
        } else {
          kudosData.received.forEach(entry => {
            const card = document.createElement('div');
            card.className = 'kudos-item';
            const date = entry.created_at ? new Date(entry.created_at).toLocaleDateString('uk-UA') : '–ù–µ—â–æ–¥–∞–≤–Ω–æ';
            card.innerHTML = `
              <div class="kudos-meta">–í—ñ–¥: ${entry.from_name} ¬∑ ${date}</div>
              <div class="kudos-message">${entry.message}</div>
            `;
            receivedContainer.appendChild(card);
          });
        }
      }

      if (sentContainer) {
        if (!kudosData.sent || kudosData.sent.length === 0) {
          sentContainer.innerHTML = '<div class="form-hint">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏—Ö kudos</div>';
        } else {
          kudosData.sent.forEach(entry => {
            const card = document.createElement('div');
            card.className = 'kudos-item';
            const date = entry.created_at ? new Date(entry.created_at).toLocaleDateString('uk-UA') : '–ù–µ—â–æ–¥–∞–≤–Ω–æ';
            card.innerHTML = `
              <div class="kudos-meta">–ö–æ–º—É: ${entry.to_name} ¬∑ ${date}</div>
              <div class="kudos-message">${entry.message}</div>
            `;
            sentContainer.appendChild(card);
          });
        }
      }
    }

    // ===== PULSE ROOMS =====
    async function loadPulseRooms() {
      const container = document.getElementById('pulse-rooms');
      if (container) container.innerHTML = '<div class="form-hint">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç...</div>';

      try {
        pulseRooms = await apiCall('/pulse/rooms');
        renderPulseRooms();
        if (!activePulseRoom && pulseRooms.length) {
          setActivePulseRoom(pulseRooms[0]);
        }
      } catch (error) {
        if (container) {
          container.innerHTML = '<div class="form-hint">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç–∏</div>';
        }
      }
    }

    function setActivePulseRoom(room) {
      activePulseRoom = room;
      renderPulseRooms();
      loadPulseMessages();
    }

    function renderPulseRooms() {
      const container = document.getElementById('pulse-rooms');
      if (!container) return;
      container.innerHTML = '';

      if (!pulseRooms || pulseRooms.length === 0) {
        container.innerHTML = '<div class="form-hint">–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫—ñ–º–Ω–∞—Ç</div>';
        return;
      }

      pulseRooms.forEach(room => {
        const card = document.createElement('div');
        card.className = `pulse-room-card${activePulseRoom?.id === room.id ? ' active' : ''}`;
        card.innerHTML = `
          <div class="plan-title">${room.title}</div>
          <div class="plan-meta">${room.description || ''}</div>
        `;
        card.addEventListener('click', () => setActivePulseRoom(room));
        container.appendChild(card);
      });
    }

    async function loadPulseMessages() {
      if (!activePulseRoom) return;
      const container = document.getElementById('pulse-messages');
      if (container) container.innerHTML = '<div class="form-hint">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å...</div>';

      try {
        pulseMessages = await apiCall(`/pulse/rooms/${activePulseRoom.slug}/messages`);
        renderPulseMessages();
      } catch (error) {
        if (container) {
          container.innerHTML = '<div class="form-hint">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</div>';
        }
      }
    }

    function renderPulseMessages() {
      const container = document.getElementById('pulse-messages');
      const meta = document.getElementById('pulse-room-meta');
      if (!container) return;

      if (meta) {
        meta.textContent = activePulseRoom
          ? `${activePulseRoom.title} ¬∑ ${activePulseRoom.description || ''}`
          : '–û–±–µ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É';
      }

      container.innerHTML = '';
      if (!pulseMessages || pulseMessages.length === 0) {
        container.innerHTML = '<div class="form-hint">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</div>';
        return;
      }

      pulseMessages.forEach(message => {
        const card = document.createElement('div');
        card.className = `pulse-message${message.status === 'PENDING' ? ' pending' : ''}`;
        const created = message.created_at ? new Date(message.created_at).toLocaleString('uk-UA') : '–ù–µ—â–æ–¥–∞–≤–Ω–æ';
        const status = message.status === 'PENDING' ? ' ¬∑ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—ó' : '';
        card.innerHTML = `
          <div class="plan-meta">${created}${status}</div>
          <div class="plan-title">${message.content}</div>
        `;
        container.appendChild(card);
      });
    }

    async function loadPulseModeration() {
      const card = document.getElementById('pulse-moderation-card');
      if (!card) return;
      if (!isAdmin()) {
        card.classList.add('hidden');
        return;
      }
      card.classList.remove('hidden');

      try {
        pulseModerationQueue = await apiCall('/pulse/moderation');
        renderPulseModeration();
      } catch (error) {
        const container = document.getElementById('pulse-moderation-queue');
        if (container) {
          container.innerHTML = '<div class="form-hint">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —á–µ—Ä–≥—É</div>';
        }
      }
    }

    function renderPulseModeration() {
      const container = document.getElementById('pulse-moderation-queue');
      if (!container) return;
      container.innerHTML = '';

      if (!pulseModerationQueue || pulseModerationQueue.length === 0) {
        container.innerHTML = '<div class="form-hint">–ß–µ—Ä–≥–∞ –ø–æ—Ä–æ–∂–Ω—è</div>';
        return;
      }

      pulseModerationQueue.forEach(item => {
        const card = document.createElement('div');
        card.className = 'moderation-card';
        const created = item.created_at ? new Date(item.created_at).toLocaleString('uk-UA') : '–ù–µ—â–æ–¥–∞–≤–Ω–æ';
        card.innerHTML = `
          <div class="plan-title">${item.room_title}</div>
          <div class="plan-meta">${created} ¬∑ ${item.room_slug}</div>
          <div style="margin-top:0.5rem;">${item.content}</div>
          <div class="toggle-row" style="margin-top:0.75rem;">
            <button class="btn btn-secondary" data-action="approve" data-id="${item.id}">Approve</button>
            <button class="btn btn-secondary" data-action="reject" data-id="${item.id}">Reject</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // ===== WALL TOXICITY =====
    async function loadWallToxicitySummary() {
      if (!isAdmin()) return;
      try {
        const data = await apiCall('/admin/wall/toxicity');
        renderWallToxicitySummary(data);
      } catch (error) {
        const container = document.getElementById('wall-toxicity-summary');
        if (container) {
          container.innerHTML = '<div class="form-hint">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ summary</div>';
        }
      }
    }

    function renderWallToxicitySummary(data) {
      const container = document.getElementById('wall-toxicity-summary');
      if (!container) return;
      container.innerHTML = '';
      if (!data) {
        container.innerHTML = '<div class="form-hint">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</div>';
        return;
      }

      const stats = document.createElement('div');
      stats.className = 'insight-item';
      stats.innerHTML = `
        <div class="insight-title">–ü–æ—Å—Ç–∏: ${data.total_posts} ¬∑ Flagged: ${data.flagged_posts}</div>
        <div class="insight-meta">–°–µ—Ä–µ–¥–Ω—è severity: ${data.avg_severity.toFixed(1)}</div>
      `;
      container.appendChild(stats);

      const themes = document.createElement('div');
      themes.className = 'insight-item';
      const themeChips = (data.top_themes || [])
        .map(t => `<span class="tag-chip">${t.theme} (${t.count})</span>`)
        .join('');
      themes.innerHTML = `
        <div class="insight-title">–¢–µ–º–∏</div>
        <div class="tag-row">${themeChips || '<span class="form-hint">–ù–µ–º–∞—î —Ç–µ–º</span>'}</div>
      `;
      container.appendChild(themes);

      const keywords = document.createElement('div');
      keywords.className = 'insight-item';
      const keywordChips = (data.keywords || [])
        .map(k => `<span class="tag-chip">#${k}</span>`)
        .join('');
      keywords.innerHTML = `
        <div class="insight-title">–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</div>
        <div class="tag-row">${keywordChips || '<span class="form-hint">–ù–µ–º–∞—î –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤</span>'}</div>
      `;
      container.appendChild(keywords);
    }

    // ===== WALL POSTS =====
    async function loadWallPosts() {
      const container = document.getElementById('wall-posts-container');
      container.innerHTML = '<div class="loading"><div class="spinner"></div><div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–≤...</div></div>';

      try {
        const posts = await apiCall('/feedback/wall');
        renderWallPosts(posts || []);
      } catch (error) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--gray);">
            –ù–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
          </div>
        `;
      }
    }

    function renderWallPosts(posts) {
      const container = document.getElementById('wall-posts-container');

      if (!posts || posts.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 3rem; color: var(--gray);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
            <div style="font-size: 1.25rem; font-weight: 700;">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤</div>
            <div style="margin-top: 0.5rem;">–ë—É–¥—å—Ç–µ –ø–µ—Ä—à–∏–º —Ö—Ç–æ –ø–æ–¥—ñ–ª–∏—Ç—å—Å—è —Ñ—ñ–¥–±–µ–∫–æ–º!</div>
          </div>
        `;
        return;
      }

      container.innerHTML = '';

      posts.forEach(post => {
        const card = document.createElement('div');
        card.className = 'wall-post fade-in';

        const header = document.createElement('div');
        header.className = 'wall-post-header';

        const meta = document.createElement('div');
        meta.className = 'wall-post-meta';

        const date = document.createElement('span');
        const created = post.created_at ? new Date(post.created_at) : null;
        date.className = 'wall-post-date';
        date.textContent = created && !isNaN(created)
          ? created.toLocaleString('uk-UA', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })
          : '–ù–µ—â–æ–¥–∞–≤–Ω–æ';

        const author = document.createElement('span');
        author.className = 'wall-author';
        author.textContent = post.is_anonymous || !post.author_name ? '–ê–Ω–æ–Ω—ñ–º–Ω–æ' : post.author_name;

        meta.appendChild(date);
        meta.appendChild(author);

        const category = document.createElement('span');
        const info = categoryMap[post.category] || { label: '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', emoji: 'üí¨' };
        category.className = `wall-category${post.ai_categorized ? ' wall-ai' : ''}`;
        category.textContent = `${info.emoji} ${info.label}`;

        header.appendChild(meta);
        header.appendChild(category);

        const content = document.createElement('div');
        content.className = 'wall-post-content';
        content.textContent = post.content;

        card.appendChild(header);
        card.appendChild(content);

        container.appendChild(card);
      });
    }

    // ===== WALL POST FORM =====
    document.getElementById('wall-post-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const content = document.getElementById('post-content').value.trim();
      const isAnonymous = document.getElementById('post-anonymous').checked;
      const statusEl = document.getElementById('wall-post-status');
      if (!content) return;

      try {
        statusEl.textContent = '–ü—É–±–ª—ñ–∫–∞—Ü—ñ—è...';
        await apiCall('/feedback/wall', {
          method: 'POST',
          body: JSON.stringify({ content, is_anonymous: isAnonymous }),
        });

        document.getElementById('post-content').value = '';
        statusEl.textContent = '‚úÖ –ü–æ—Å—Ç —É—Å–ø—ñ—à–Ω–æ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ!';

        // Reload posts
        await loadWallPosts();

      } catch (error) {
        statusEl.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message;
      }
    });

    document.getElementById('post-anonymous').addEventListener('change', (e) => {
      const preview = document.getElementById('post-visibility-preview');
      preview.textContent = e.target.checked ? '–ê–Ω–æ–Ω—ñ–º–Ω–æ' : `–ü—É–±–ª—ñ—á–Ω–æ: ${currentUser?.name || 'User'}`;
    });

    // ===== WELLNESS GOALS =====
    const wellnessGoalsForm = document.getElementById('wellness-goals-form');
    if (wellnessGoalsForm) {
      wellnessGoalsForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const statusEl = document.getElementById('wellness-goals-status');
        statusEl.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';

        const payload = {
          sleep_target: parseInt(document.getElementById('goal-sleep').value, 10),
          break_target: parseInt(document.getElementById('goal-breaks').value, 10),
          move_target: parseInt(document.getElementById('goal-move').value, 10),
          notifications_enabled: document.getElementById('goal-notifications').checked,
        };

        try {
          wellnessGoals = await apiCall('/wellness/goals', {
            method: 'POST',
            body: JSON.stringify(payload),
          });
          statusEl.textContent = '‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ';
          renderWellness();
        } catch (error) {
          statusEl.textContent = '‚ùå ' + error.message;
        }
      });
    }

    const completePlanBtn = document.getElementById('complete-plan-btn');
    if (completePlanBtn) {
      completePlanBtn.addEventListener('click', async () => {
        const statusEl = document.getElementById('wellness-plan-status');
        statusEl.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';
        try {
          await apiCall('/wellness/plan/complete', { method: 'POST' });
          await loadWellnessData();
          statusEl.textContent = '‚úÖ –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–æ';
        } catch (error) {
          statusEl.textContent = '‚ùå ' + error.message;
        }
      });
    }

    // ===== KUDOS FORM =====
    const kudosForm = document.getElementById('kudos-form');
    if (kudosForm) {
      kudosForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const statusEl = document.getElementById('kudos-status');
        statusEl.textContent = '–í—ñ–¥–ø—Ä–∞–≤–∫–∞...';

        const recipient = document.getElementById('kudos-email').value.trim();
        const message = document.getElementById('kudos-message').value.trim();
        if (!recipient || !message) {
          statusEl.textContent = '‚ùå –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è';
          return;
        }

        try {
          await apiCall('/kudos', {
            method: 'POST',
            body: JSON.stringify({ recipient_email: recipient, message }),
          });
          statusEl.textContent = '‚úÖ Kudos –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ';
          document.getElementById('kudos-message').value = '';
          await loadKudos();
        } catch (error) {
          statusEl.textContent = '‚ùå ' + error.message;
        }
      });
    }

    // ===== PULSE MESSAGE FORM =====
    const pulseMessageForm = document.getElementById('pulse-message-form');
    if (pulseMessageForm) {
      pulseMessageForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const statusEl = document.getElementById('pulse-message-status');
        statusEl.textContent = '';

        if (!activePulseRoom) {
          statusEl.textContent = '–û–±–µ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É';
          return;
        }

        const content = document.getElementById('pulse-message-content').value.trim();
        if (!content) {
          statusEl.textContent = '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—î';
          return;
        }

        try {
          const res = await apiCall(`/pulse/rooms/${activePulseRoom.slug}/messages`, {
            method: 'POST',
            body: JSON.stringify({
              content,
              is_anonymous: document.getElementById('pulse-anonymous').checked,
            }),
          });
          document.getElementById('pulse-message-content').value = '';
          if (res?.status === 'PENDING') {
            statusEl.textContent = '‚è≥ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—ó';
          } else {
            statusEl.textContent = '‚úÖ –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ';
            await loadPulseMessages();
          }
          if (isAdmin()) {
            await loadPulseModeration();
          }
        } catch (error) {
          statusEl.textContent = '‚ùå ' + error.message;
        }
      });
    }

    const moderationQueue = document.getElementById('pulse-moderation-queue');
    if (moderationQueue) {
      moderationQueue.addEventListener('click', async (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;
        const action = btn.dataset.action;
        const id = btn.dataset.id;
        if (!id) return;

        try {
          if (action === 'approve') {
            await apiCall(`/pulse/messages/${id}/approve`, { method: 'POST' });
          } else if (action === 'reject') {
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–π–Ω–æ):') || '';
            await apiCall(`/pulse/messages/${id}/reject`, {
              method: 'POST',
              body: JSON.stringify({ reason }),
            });
          }
          await loadPulseModeration();
          if (activePulseRoom) {
            await loadPulseMessages();
          }
        } catch (error) {
          console.error(error);
        }
      });
    }

    // ===== TELEGRAM SETTINGS =====
    async function loadTelegramStatus() {
      const status = await apiCall('/telegram/status');
      if (!status) return;

      const connection = document.getElementById('telegram-connection-status');
      const pinInfo = document.getElementById('telegram-pin-info');
      const pinExpiry = document.getElementById('pin-expiry');

      if (status.connected) {
        connection.textContent = `‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ (ID ${status.telegram_id})`;
        pinInfo.textContent = '';
        pinExpiry.textContent = '';
      } else {
        connection.textContent = '‚õî –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ';
        if (status.active_pin) {
          pinInfo.textContent = `–ê–∫—Ç–∏–≤–Ω–∏–π PIN: ${status.active_pin}`;
          pinExpiry.textContent = '–î—ñ—î 5 —Ö–≤';
        } else {
          pinInfo.textContent = 'PIN –Ω–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ';
          pinExpiry.textContent = '';
        }
      }

      document.getElementById('reminder-time').value =
        `${String(status.reminder_hour).padStart(2, '0')}:${String(status.reminder_minute).padStart(2, '0')}`;
      document.getElementById('timezone-input').value = status.timezone || 'UTC';
      document.getElementById('notifications-enabled').checked = !!status.notification_enabled;
    }

    document.getElementById('generate-pin-btn').addEventListener('click', async () => {
      const pinInfo = document.getElementById('telegram-pin-info');
      const pinExpiry = document.getElementById('pin-expiry');
      try {
        const data = await apiCall('/telegram/generate-pin', { method: 'POST' });
        pinInfo.textContent = `–ê–∫—Ç–∏–≤–Ω–∏–π PIN: ${data.pin_code}`;
        pinExpiry.textContent = '–î—ñ—î 5 —Ö–≤';
      } catch (error) {
        pinInfo.textContent = '‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ PIN';
        pinExpiry.textContent = '';
      }
    });

    document.getElementById('telegram-settings-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const statusEl = document.getElementById('telegram-settings-status');
      statusEl.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';

      const reminderTime = document.getElementById('reminder-time').value;
      const timezone = document.getElementById('timezone-input').value.trim();
      const notificationsEnabled = document.getElementById('notifications-enabled').checked;

      const payload = {
        notification_enabled: notificationsEnabled,
      };

      if (reminderTime) {
        payload.reminder_time = reminderTime;
      }
      if (timezone) {
        payload.timezone = timezone;
      }

      try {
        await apiCall('/telegram/preferences', {
          method: 'POST',
          body: JSON.stringify(payload),
        });
        statusEl.textContent = '‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ';
        await loadTelegramStatus();
      } catch (error) {
        statusEl.textContent = '‚ùå ' + error.message;
      }
    });

    // ===== ADMIN HEATMAP =====
    async function loadTeamHeatmap() {
      if (!isAdmin()) return;
      const data = await apiCall('/admin/heatmap');
      teamHeatmap = data;
      renderTeamHeatmap(data);
      renderRiskSummary();
    }

    function renderTeamHeatmap(data) {
      const container = document.getElementById('team-heatmap');
      container.innerHTML = '';

      if (!data || !data.users || data.users.length === 0) {
        container.innerHTML = '<div class="form-hint">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</div>';
        return;
      }

      const statusLabel = (status) => {
        switch (status) {
          case 'CRITICAL': return { label: '–ö—Ä–∏—Ç–∏—á–Ω–∏–π', color: 'var(--danger)' };
          case 'CONCERNING': return { label: '–†–∏–∑–∏–∫', color: 'var(--warning)' };
          case 'GOOD': return { label: '–î–æ–±—Ä–µ', color: 'var(--success)' };
          case 'EXCELLENT': return { label: '–í—ñ–¥–º—ñ–Ω–Ω–æ', color: 'var(--success)' };
          default: return { label: '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö', color: 'var(--gray)' };
        }
      };

      data.users.forEach(user => {
        const card = document.createElement('div');
        card.className = 'metric-card';

        const status = statusLabel(user.status);
        const earlySignal = user.early_signal
          ? `‚ö° ${user.early_signal.level} ¬∑ ${(user.early_signal.indicators || []).slice(0, 2).join(', ')}`
          : '';
        const actionCards = (user.action_cards || [])
          .map(card => `<div class="action-card"><strong>${card.title}</strong><br>${card.description}</div>`)
          .join('');
        card.innerHTML = `
          <div class="metric-label">${user.name}</div>
          <div class="metric-desc" style="color:${status.color}; font-weight:700;">${status.label}</div>
          <div class="form-hint">WHO-5: ${user.who5_score.toFixed(1)} ¬∑ Burnout: ${user.burnout_percentage.toFixed(1)}%</div>
          <div class="form-hint">Streak: ${user.streak} –¥–Ω—ñ–≤</div>
          ${earlySignal ? `<div class="form-hint">${earlySignal}</div>` : ''}
          ${actionCards}
        `;

        container.appendChild(card);
      });
    }

    // ===== ADMIN USERS =====
    async function loadAdminUsers() {
      if (!isAdmin()) return;
      try {
        const data = await apiCall('/admin/users');
        adminUsers = Array.isArray(data) ? data : [];
        renderAdminUsers();
      } catch (error) {
        const tbody = document.getElementById('admin-users-table');
        if (tbody) {
          tbody.innerHTML = '<tr><td colspan="6">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</td></tr>';
        }
      }
    }

    function renderAdminUsers() {
      const tbody = document.getElementById('admin-users-table');
      if (!tbody) return;

      const term = adminSearch.trim().toLowerCase();
      const filtered = adminUsers.filter(user => {
        if (!showInactiveUsers && !user.is_active) return false;
        if (!term) return true;
        return user.name.toLowerCase().includes(term) || user.email.toLowerCase().includes(term);
      });

      tbody.innerHTML = '';

      if (!filtered.length) {
        tbody.innerHTML = '<tr><td colspan="6">–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ —Ü–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º</td></tr>';
        return;
      }

      const canManageTarget = (target) => {
        if (!currentUser) return false;
        if (target.id === currentUser.user_id) return false;
        if ((target.role === 'ADMIN' || target.role === 'FOUNDER') && currentUser.role !== 'FOUNDER') {
          return false;
        }
        return true;
      };

      filtered.forEach(user => {
        const tr = document.createElement('tr');
        if (!user.is_active) tr.classList.add('admin-row-inactive');

        const userCell = document.createElement('td');
        userCell.dataset.label = '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
        const nameEl = document.createElement('div');
        nameEl.style.fontWeight = '700';
        nameEl.textContent = user.name;
        const emailEl = document.createElement('div');
        emailEl.className = 'form-hint';
        emailEl.textContent = user.email;
        userCell.appendChild(nameEl);
        userCell.appendChild(emailEl);
        if (user.note) {
          const noteEl = document.createElement('div');
          noteEl.className = 'form-hint';
          noteEl.textContent = user.note;
          userCell.appendChild(noteEl);
        }

        const roleCell = document.createElement('td');
        roleCell.dataset.label = '–†–æ–ª—å';
        roleCell.textContent = user.role;

        const statusCell = document.createElement('td');
        statusCell.dataset.label = '–°—Ç–∞—Ç—É—Å';
        const statusChip = document.createElement('span');
        statusChip.className = 'status-chip';
        statusChip.textContent = user.is_active ? '–ê–∫—Ç–∏–≤–Ω–∏–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π';
        statusCell.appendChild(statusChip);

        const createdCell = document.createElement('td');
        createdCell.dataset.label = '–°—Ç–≤–æ—Ä–µ–Ω–æ';
        createdCell.textContent = user.created_at
          ? new Date(user.created_at).toLocaleDateString('uk-UA')
          : '‚Äî';

        const offboardedCell = document.createElement('td');
        offboardedCell.dataset.label = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ';
        offboardedCell.textContent = user.offboarded_at
          ? new Date(user.offboarded_at).toLocaleDateString('uk-UA')
          : '‚Äî';
        if (user.offboarded_reason) {
          const reasonEl = document.createElement('div');
          reasonEl.className = 'form-hint';
          reasonEl.textContent = user.offboarded_reason;
          offboardedCell.appendChild(reasonEl);
        }

        const actionsCell = document.createElement('td');
        actionsCell.dataset.label = '–î—ñ—ó';
        actionsCell.className = 'admin-actions';

        const canManage = canManageTarget(user);
        if (user.is_active) {
          const deactivateBtn = document.createElement('button');
          deactivateBtn.className = 'btn btn-secondary';
          deactivateBtn.textContent = '–î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏';
          deactivateBtn.dataset.action = 'deactivate';
          deactivateBtn.dataset.id = user.id;
          if (!canManage) deactivateBtn.disabled = true;
          actionsCell.appendChild(deactivateBtn);
        } else {
          const reactivateBtn = document.createElement('button');
          reactivateBtn.className = 'btn btn-success';
          reactivateBtn.textContent = '–í—ñ–¥–Ω–æ–≤–∏—Ç–∏';
          reactivateBtn.dataset.action = 'reactivate';
          reactivateBtn.dataset.id = user.id;
          if (!canManage) reactivateBtn.disabled = true;
          actionsCell.appendChild(reactivateBtn);
        }

        const resetBtn = document.createElement('button');
        resetBtn.className = 'btn btn-primary';
        resetBtn.textContent = '–°–∫–∏–Ω—É—Ç–∏ –∫–æ–¥';
        resetBtn.dataset.action = 'reset';
        resetBtn.dataset.id = user.id;
        if (!canManage) resetBtn.disabled = true;
        actionsCell.appendChild(resetBtn);

        tr.appendChild(userCell);
        tr.appendChild(roleCell);
        tr.appendChild(statusCell);
        tr.appendChild(createdCell);
        tr.appendChild(offboardedCell);
        tr.appendChild(actionsCell);
        tbody.appendChild(tr);
      });
    }

    const adminSearchInput = document.getElementById('admin-user-search');
    if (adminSearchInput) {
      adminSearchInput.addEventListener('input', (e) => {
        adminSearch = e.target.value || '';
        renderAdminUsers();
      });
    }

    const adminShowInactive = document.getElementById('admin-show-inactive');
    if (adminShowInactive) {
      adminShowInactive.addEventListener('change', (e) => {
        showInactiveUsers = !!e.target.checked;
        renderAdminUsers();
      });
    }

    const generateUserCodeBtn = document.getElementById('generate-user-code');
    if (generateUserCodeBtn) {
      generateUserCodeBtn.addEventListener('click', () => {
        const code = String(Math.floor(1000 + Math.random() * 9000));
        const codeInput = document.getElementById('admin-user-code');
        if (codeInput) {
          codeInput.value = code;
        }
      });
    }

    const adminUserForm = document.getElementById('admin-user-form');
    if (adminUserForm) {
      adminUserForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const statusEl = document.getElementById('admin-user-status');
        if (statusEl) statusEl.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';

        const name = document.getElementById('admin-user-name').value.trim();
        const email = document.getElementById('admin-user-email').value.trim();
        const role = document.getElementById('admin-user-role').value;
        const code = document.getElementById('admin-user-code').value.trim();
        const note = document.getElementById('admin-user-note').value.trim();

        if (!name || !email || !code) {
          if (statusEl) statusEl.textContent = '‚ùå –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –ø–æ–ª—è';
          return;
        }

        try {
          await apiCall('/admin/users', {
            method: 'POST',
            body: JSON.stringify({
              name,
              email,
              code,
              role: role || 'EMPLOYEE',
              note: note || null
            }),
          });
          if (statusEl) statusEl.textContent = '‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ';
          adminUserForm.reset();
          await loadAdminUsers();
        } catch (error) {
          if (statusEl) statusEl.textContent = `‚ùå ${error.message}`;
        }
      });
    }

    const adminUsersTable = document.getElementById('admin-users-table');
    if (adminUsersTable) {
      adminUsersTable.addEventListener('click', async (e) => {
        const target = e.target.closest('button[data-action]');
        if (!target) return;

        const action = target.dataset.action;
        const userId = target.dataset.id;
        if (!userId) return;

        try {
          if (action === 'deactivate') {
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó (–æ–ø—Ü—ñ–π–Ω–æ):') || null;
            if (!confirm('–î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?')) return;
            await apiCall(`/admin/users/${userId}/deactivate`, {
              method: 'POST',
              body: JSON.stringify({ reason }),
            });
          } else if (action === 'reactivate') {
            if (!confirm('–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É?')) return;
            await apiCall(`/admin/users/${userId}/reactivate`, {
              method: 'POST',
            });
          } else if (action === 'reset') {
            const code = prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π 4-–∑–Ω–∞—á–Ω–∏–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø—É:');
            if (!code) return;
            await apiCall(`/admin/users/${userId}/reset-code`, {
              method: 'POST',
              body: JSON.stringify({ code: code.trim() }),
            });
            alert('–ö–æ–¥ –æ–Ω–æ–≤–ª–µ–Ω–æ');
          }

          await loadAdminUsers();
        } catch (error) {
          alert(`–ü–æ–º–∏–ª–∫–∞: ${error.message}`);
        }
      });
    }

    async function loginWithToken(token) {
      const data = await apiCall('/auth/token-login', {
        method: 'POST',
        body: JSON.stringify({ token }),
      });
      currentUser = data;
      window.history.replaceState({}, document.title, window.location.pathname);
      await loadApp();
    }

    // ===== AUTO-LOAD ON SESSION =====
    (async function() {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      if (token) {
        try {
          await loginWithToken(token);
          return;
        } catch (error) {
          showLogin();
          return;
        }
      }

      try {
        const user = await apiCall('/dashboard/me');
        currentUser = user;
        await loadApp();
      } catch (error) {
        showLogin();
      }
    })();
  </script>

</body>
</html>
